from Bio import SeqIO

file = open("newkraken.out", "r")
d_kraken = {}
unclassified = []
for line in file:
    if line.startswith("C"):
        id = line.split("\t")[1]
        oznaka_krakena = line.split("\t")[2].split("(")[0][:-1]
        taxid = line.split("\t")[2].split("(")[1].split(" ")[1][:-1]
        d_kraken[id] = [oznaka_krakena, taxid]
    elif line.startswith("U"):
        neklasificiran = line.split("\t")[1]
        if neklasificiran not in unclassified:
            unclassified.append(neklasificiran)
file.close()
#print(d_kraken)
#print(unclassified)
print("KLASIFICIRANI: ", len(d_kraken))
print("NEKLASIFICIRANI (FALSE NEGATIVE): ", len(unclassified))

ukupni_rijecnik = {}
with open("zymo_binned_bacillus_subtilis.fastq", "r") as f:
    for record in SeqIO.parse(f, "fastq"):
        ukupni_rijecnik[record.id] = ["Bacillus subtilis", "1423"]
f.close()
with open("zymo_binned_enterococcus_faecalis.fastq", "r") as f:
    for record in SeqIO.parse(f, "fastq"):
        ukupni_rijecnik[record.id] = ["Enterococcus faecalis", "1351"]
f.close()
with open("zymo_binned_escherichia_coli.fastq", "r") as f:
    for record in SeqIO.parse(f, "fastq"):
        ukupni_rijecnik[record.id] = ["Escherichia coli", "562"]
f.close()
with open("zymo_binned_lactobacillus_fermentum.fastq", "r") as f:
    for record in SeqIO.parse(f, "fastq"):
        ukupni_rijecnik[record.id] = ["Lactobacillus fermentum", "1613"]
f.close()
with open("zymo_binned_listeria_monocytogenes.fastq", "r") as f:
    for record in SeqIO.parse(f, "fastq"):
        ukupni_rijecnik[record.id] = ["Listeria monocytogenes", "1639"]
f.close()
with open("zymo_binned_pseudomonas_aeruginosa.fastq", "r") as f:
    for record in SeqIO.parse(f, "fastq"):
        ukupni_rijecnik[record.id] = ["Pseudomonas aeruginosa", "287"]
f.close()
with open("zymo_binned_salmonella_enterica.fastq", "r") as f:
    for record in SeqIO.parse(f, "fastq"):
        ukupni_rijecnik[record.id] = ["Salmonella enterica", "28901"]
f.close()
with open("zymo_binned_staphylococcus_aureus.fastq", "r") as f:
    for record in SeqIO.parse(f, "fastq"):
        ukupni_rijecnik[record.id] = ["Staphylococcus aureus", "1280"]
f.close()

d_fastq = {}
with open("zymo_binned_all.fastq", "r") as f:
    for record in SeqIO.parse(f, "fastq"):
        id_reada = record.id
        if id_reada in ukupni_rijecnik:
            d_fastq[id_reada] = ukupni_rijecnik[id_reada]
        else:
            print("Tu sam")
            d_fastq[id_reada] = ["Error", "?"]
f.close()

tocno = []
soj = []
rod = []
krivo = []
taksonomija_iznad = []
for key, value in d_kraken.items():
    if d_fastq[key][1] == value[1]:
        tocno.append(key)
    elif value == ['Bacteria', '2'] or d_fastq[key][1] == '?':
        krivo.append(key)
    elif d_fastq[key][0] == 'Bacillus subtilis':
        if value[1] in ['135461', '1404258', '1192196', '535024', '535026', '1147161', '224308', '1302650', '1221328', '535025', '1052588', '1496303', '936156', '86029', '1233100', '1415167', '1340494', '1204342', '1220533']:
            soj.append(key)
        elif value[1] in ['1386', '653685', '96241', '1052585', '703612', '655816', '483913', '72361', '653388', '260554', '72360', '1938374', '492670', '1458206', '1150476', '1338518', '1449088', '1385727', '1155777', '1225788', '1114958', '1423138', '1390', '1333538', '1434324', '692420', '1034836', '1292358', '999891', '1091041', '659243', '1452', '1239783', '1529886', '720555', '2054641', '1648923', '227866', '1402', '1126218', '119858', '185979', '2809036', '2762329', '1071078', '1774743', '2093834', '2049935', '352858', '1837130', '2962681', '2683680', '1127744', '2884834', '666686', '2709784', '2070759', '2014076', '2682541', '1705566', '2933872', '2009331', '1581038', '2884832', '2925318', '2933563', '2821409', '2666127', '1071080', '1868655', '2875710', '2888526', '2859227', '2587848', '2448811', '486398', '1574141', '563169', '98228', '2762326', '3035514', '2529386', '2589818', '1027627', '1941347', '745774', '2846779', '1446792', '2233998', '1167886', '2796141', '1806216', '2912825', '580459', '2665175', '86661', '1428', '29339', '1279365', '570416', '1261129', '180854', '527030', '180850', '257985', '1423143', '529122', '180882', '527022', '1432', '1286404', '1001229', '541229', '1417985', '1218175', '527020', '1396', '288681', '526992', '1217984', '526986', '226900', '1179100', '637380', '572264', '451709', '526987', '526980', '222523', '1392', '1452727', '1392837', '568206', '1405', '580165', '64104', '527000', '2026186', '1890302', '2026188', '2026193', '2750818', '1892404', '1839798', '2026189', '155322', '2026187', '2026191', '658666', '1330043', '1792192', '293387', '2487276', '2715209', '1664069', '561879', '1178541', '1408', '1471', '796606', '2672567', '1479', '1983719', '324767', '1367477', '1742359', '1925021', '1455', '1547283', '1441095', '1178537', '2728853']:
            rod.append(key)
        elif value[1] in ['1239', '91061', '1385', '186817']:
            taksonomija_iznad.append(key)
    elif d_fastq[key][0] == 'Enterococcus faecalis':
        if value[1] in ["565651","1206105","474186","936153","226185","699186","1201292","1287066","1157365","1261557"]:
            soj.append(key)
        elif value[1] in ['1350', '1352', '1305849', '1328870', '333849', '1344042', '565663', '118060', '44008', '1354', '768486', '1353', '53345', '33945', '41997', '1814218', '53346', '71452', '37734', '565655', '417368', '1805431', '2005703', '160453', '44009', '2608891', '2582830', '2057791', '2420313', '2920934', '2839759']:
            rod.append(key)
        elif value[1] in ['1239', '91061', '186826', '81852']:
            taksonomija_iznad.append(key)
    elif d_fastq[key][0] == 'Escherichia coli':
        if value[1] in ['83334', '996639', '155864', '1328859', '502346', '1343836', '444450', '386585', '1330457', '544404', '83333', '511145', '879462', '679895', '1403831', '1245474', '595496', '316385', '316407', '1038927', '1134782', '1048254', '1133853', '1133852', '244320', '701177', '1048689', '168807', '574521', '2861805', '1446746', '340186', '2603836', '1055538', '2848144', '481805', '2605620', '331112', '1329907', '2605619', '2778655', '2778657', '1392854', '2048777', '941322', '2848145', '591946', '1050617', '930406', '1446608', '913091', '1045010', '696406', '1446701', '585397', '2763104', '1446738', '1446739', '991915', '1001989', '585057', '2697517', '1382700', '869729', '2874051', '2048781', '1055537', '1055543', '913088', '2861806', '1072458', '1072459', '566546', '1603259', '331111', '2491679', '2067421', '1412834', '2027293', '861906', '216592', '376725', '585395', '2233553', '1055541', '1446707', '2778656', '2773707', '469008', '511693', '2810404', '2048775', '2848143', '585055', '2773705', '745156', '2048778', '1311757', '2810407', '2810406', '2990471', '439855', '362663', '1401688', '2048780', '1355101', '316435', '405955', '2592065', '1358422', '1078021', '168927', '585396', '2773706', '1274814', '1055536', '1055540', '1078034', '1248915', '1248823', '37762', '2822132', '1078032', '758831', '199310', '183192', '1954351', '585034', '569579', '866768', '2027295', '244319', '573235', '2079157', '2778652', '409438', '941280', '2810405', '364106', '1441627', '2810409', '2072463', '1502658', '3038394', '2874053', '2491692', '3041057', '941323', '2814546', '413997', '404399', '1055534', '1055533', '1055539', '1055545', '2491878', '498388', '866789', '1200752', '1322345', '577675', '714962', '1335302', '1335303', '2126982', '741093', '2778654', '655817', '1446600', '1392858', '536056', '2048776', '595495', '2773704', '585035', '2874052', '2990470', '1055535', '1055542', '2969654', '991919', '373045', '885275', '2990469', '1435461', '1355100', '1335916', '431946', '685037', '685038', '753642', '585056']:
            soj.append(key)
        elif value[1] in ['561', '208962', '1440052', '1499973', '564', '981367', '585054', '2608889', '2044467', '2725997']:
            rod.append(key)
        elif value[1] in ['1224', '1236', '91347', '543']:
            taksonomija_iznad.append(key)
        #elif value == ['Escherichia coli BL2', ''] or value == ["Escherichia coli 'BL21-Gol", 'AG']:
            #soj.append(key)
    elif d_fastq[key][0] == 'Lactobacillus fermentum':
        if value[1] in ["767453","334390","1381124"]:
            soj.append(key)
        elif value[1] in ['2742598', '1598', '557436', '557433', '1358027', '927703', '1340495', '491077', '97478', '1130798', '35787', '1633', '227942', '47493', '104955', '1632', '2742601']:
            rod.append(key)
        elif value[1] in ['1239', '91061', '186826', '33958']:
            taksonomija_iznad.append(key)
        #elif value == ['Lactobacillus sp. 3', '']:
            #krivo.append(key)
    elif d_fastq[key][0] == 'Listeria monocytogenes':
        if value[1] in ['393119', '552536', '2065118', '1196174', '1230340', '1134669', '1196161', '265669', '1196159', '1196172', '568819', '1196162', '1196173', '1196171', '1196175', '930781', '882097', '1906951', '1196165', '1385997', '1196170', '1196176', '1386004', '1386001', '1386005', '1196167', '1385999', '1386002', '1196168', '1385998', '1386003', '1386000', '1386008', '1196186', '1386007', '1385996', '1196180', '1196188', '1196181', '1196169', '1196183', '1196177', '1196185', '1196189', '1196192', '1196190', '863767', '879089', '1126011', '882094', '1457188', '879088', '882095', '930782', '393118', '169963', '1288295', '932919', '393132', '1457187', '1027396', '393126', '879090', '932920', '1299895', '882096', '563174', '393133', '2049008', '1196194', '1196193', '393127', '1334565', '637381', '1437838', '1030009', '2559246', '1386006', '2291966', '1196163', '1196164', '393130', '882020', '2291968', '1196195']:
            soj.append(key)
        elif value[1] in ['1637', '1642', '702455', '272626', '529731', '1638', '202751', '881621', '202752', '1457190', '1643', '386043', '1640', '683837', '702453', '2642072', '1844999', '2678528', '1006155', '1641', '1497681']:
            rod.append(key)
        elif value[1] in ['1239', '91061', '1385', '186820']:
            taksonomija_iznad.append(key)
    elif d_fastq[key][0] == 'Pseudomonas aeruginosa':
        if value[1] in ['381754', '1193501', '1427342', '1352355', '1158200', '1280938', '1009714', '1400868', '208963', '1408274', '1123015', '1415629', '1457392', '1448140', '1279007', '941193', '1093787', '1279008', '388272', '557722', '1443105', '1408271', '1408272', '1089456', '1340851', '1408277', '208964', '1147787', '1356855', '1408275', '1408276', '1051003', '1051004', '1163396', '1408273', '798130', '910265', '652611']:
            soj.append(key)
        elif value[1] in ['286', '136841', '627141', '95301', '46680', '2994495', '53408', '43263', '300', '1001585', '1225174', '1232139', '301', '1182590', '1149133', '53412', '1245471', '196821', '75692', '2545800', '2866282', '3020843', '2892442', '2961893', '2653853', '2749999', '2975373', '1294143', '2933816', '3019098', '2664899', '3016341', '2731552', '2587859', '1357074', '1755504', '2974552', '2724470', '2986947', '2774873', '2614442', '2804761', '2895495', '2705472', '2898441', '1898684', '2986927', '2811422', '2083055', '1930532', '2895488', '2201356', '2870840', '2730851', '1173280', '1856685', '2748080', '2893890', '658630', '1981174', '2908006', '2815936', '2605424', '2479393', '3020907', '2862945', '2049589', '95619', '1028989', '2866592', '2931382', '2706126', '1344094', '2726989', '2726956', '2597770', '2866277', '2895473', '2662033', '3031044', '3028807', '1611770', '2895493', '2973088', '1881017', '2559074', '2587597', '2944234', '2886361', '1736226', '2083053', '2678260', '2073078', '2994661', '3019968', '2998079', '2962597', '2895490', '2816906', '1573720', '2590776', '2604941', '2870860', '1283291', '2972478', '658644', '2730848', '2866807', '2866808', '2678261', '2879114', '2895491', '2895475', '2895486', '2054919', '2219057', '2895480', '2901380', '1636610', '1259844', '2874628', '2866626', '2730847', '2054915', '2995173', '2054914', '2995174', '2866278', '2052956', '2850559', '2834406', '2825975', '3034675', '2867408', '2883205', '2512235', '2678259', '2678258', '2678257', '2498848', '2169583', '2870750', '1573711', '3029060', '2813842', '2886360', '2841064', '2871493', '2821559', '3031046', '2920387', '3035289', '2743971', '2855434', '2861775', '2895484', '2895482', '2864101', '2944252', '2961531', '2867409', '2895494', '2895471', '2991051', '2976884', '2976883', '2320270', '2025658', '2054916', '2651048', '658643', '2662034', '2697023', '658642', '1500687', '658641', '1173283', '2730850', '1415630', '1886807', '645292', '1573714', '2749807', '517398', '2126069', '253237', '2762896', '2083054', '1761895', '1758730', '1573719', '2067572', '118613', '136843', '294', '1038922', '746360', '1221522', '463794', '743713', '380021', '47883', '198620', '29442', '129817', '183795', '47878', '76760', '200451', '1282356', '47879', '46679', '76758', '651740', '78543', '75612', '1114970', '321662', '1395516', '1421430', '169669', '75588', '200450', '76761', '136845', '303', '1384061', '1211579', '1042876', '1081940', '1150601', '1196325', '231023', '1215087', '1331671', '70775', '1785161', '47880', '743720', '76759', '47885', '2217867', '78327', '136842', '587753', '1513890', '587851', '86192', '296', '86185', '136849', '251695', '317', '321', '1262350', '1332075', '199201', '264449', '103796', '1357279', '251698', '29438', '360920', '693985', '47877', '251722', '33069', '86840', '757414', '251701', '323', '223283', '59511', '200454', '36746', '1441629', '46257', '251699', '251654', '50340', '53409', '2725477', '1245526', '2493633', '237610', '312306', '384676', '319939', '157783', '65741', '1301098', '658629', '1392877', '2731681', '2842354', '104087', '930166', '1499686', '556533', '2320867', '157782', '2746321', '2565368', '2604832', '395598', '2815720', '244566', '359110', '46677', '364197', '191390', '289370', '2774460', '122355', '2837969', '640205', '2745490', '2045200', '53407', '198618', '216142', '2745495', '2745504', '2762577', '2842357', '86265', '1274359', '2684212', '437900', '237609', '1691904', '2505979', '2842356', '2056231', '47884', '2518644', '2666183', '2842349', '2745503', '2745482', '321846', '1931241', '1853130', '489632', '1785145', '1628086', '47886', '1148509', '158627', '2011015', '2745509', '219572', '515393', '554344', '2681983', '2842355', '2599595', '2894079', '2213015', '2842350', '95300', '2842346', '2867264', '163011', '2906062', '2961896', '2774461', '2964670', '485870', '2745518', '2745512', '2745514', '2219225', '1788301', '2502979', '2745498', '1163398', '1302376']:
            rod.append(key)
        elif value[1] in ['1224', '1236', '72274', '135621']:
            taksonomija_iznad.append(key)
        #elif value == ['Pseudomonas sp. SL', ''] or value == ['Pseudomonas sp. PS', ''] or value == ['Pseudomonas sp. SC', '']:
            #rod.append(key)
    elif d_fastq[key][0] == 'Salmonella enterica':
        if value[1] in ['59201', '90371', '1029978', '1008297', '1454642', '1454647', '1620419', '1271862', '99287', '588858', '1454638', '990282', '568709', '1454636', '1454630', '1454643', '1454639', '1454644', '1454640', '1454641', '568708', '1454634', '1454645', '119912', '904139', '938142', '321314', '149539', '1412457', '1243619', '1412580', '926034', '1244111', '1412534', '1244113', '1244118', '1412601', '1412470', '1244112', '886715', '1412575', '1412558', '1412550', '1412618', '1412532', '1412455', '1412467', '1412453', '1244121', '1412562', '1412501', '1243621', '1412548', '1412510', '1412495', '1412600', '1412494', '1244119', '1412527', '1412598', '1412472', '1244122', '1243620', '1412571', '1412594', '1412582', '696867', '1412481', '1412465', '1412565', '1412536', '1412593', '1412486', '1412525', '1412464', '1412476', '1412559', '1412555', '1412509', '1412511', '1412497', '1412468', '1412484', '1412521', '1412543', '1412573', '1412454', '1412492', '1412567', '1412604', '1412471', '1412588', '1412597', '1412493', '1412583', '1412576', '1412475', '1412517', '1412574', '1412599', '1412591', '1412616', '1412564', '1412459', '1412566', '1412603', '1412490', '1412508', '1412569', '1412478', '1412479', '1412541', '1412535', '1412507', '1412615', '1412545', '1412587', '1412528', '1412513', '1412500', '1412451', '1412578', '998822', '1412502', '1412514', '1412530', '1412498', '1412549', '550537', '1412552', '1412610', '1412590', '1412596', '1412506', '1412489', '1412568', '1412503', '1412613', '1412539', '1412563', '1412606', '1412531', '1412482', '1412609', '90370', '527001', '1132507', '209261', '220341', '108619', '796731', '796730', '930779', '796732', '1454620', '1454627', '1454614', '796733', '997339', '1454621', '930778', '1454618', '1299166', '858305', '858307', '423368', '858306', '1454625', '1454622', '1454617', '1454616', '1454619', '877468', '1242080', '1242091', '98360', '687860', '909945', '439851', '192955', '1242102', '1242085', '1242107', '28150', '749965', '58101', '595', '596155', '28144', '58712', '1399029', '1454596', '1454586', '1454585', '984211', '1454594', '1454584', '1454592', '1454583', '1454593', '1454588', '1454590', '1454589', '1454587', '54388', '941189', '554290', '295319', '58096', '1182174', '1208629', '1182178', '1182181', '1182188', '1182191', '1208622', '1173456', '1182183', '1182172', '1182176', '1173427', '1182180', '1182177', '1182193', '1173459', '1183393', '211968', '1173798', '487004', '1242081', '1242096', '189201', '1271863', '611', '1160717', '1124936', '454169', '1029997', '1271864', '1299044', '115981', '1454607', '1454603', '1454610', '859199', '1454601', '763921', '1454613', '1454609', '1454599', '745022', '1454598', '1454611', '1454612', '1454604', '1454606', '1454608', '594', '685040', '550538', '909947', '286783', '593905', '57743', '1173939', '192954', '984237', '58095', '1406860', '454166', '1072590', '913085', '1243595', '82689', '1124958', '1124959', '1243590', '1243591', '570935', '941188', '2021403', '2583588', '149391', '930771', '143221', '1003191', '90105', '702982', '149385', '1242079', '1242088', '2024273', '149388', '57046', '476213', '57045', '224729', '1016998', '1242084', '1242106', '260368', '1240708', '1160769', '216804', '28147', '997333', '57741', '1242082', '1242098', '340190', '439843', '440524', '866913', '1077085', '192953', '600', '1064551', '935705', '1243585', '1243586', '932733', '486994', '1242097', '1151001', '605', '1029979', '2926665', '181798', '938141', '29482', '1029983', '340188', '1410916', '1243583', '1243584', '286782', '1194159', '58097', '1320309', '29474', '604', '1225522', '913074', '941187', '358771', '363569', '1267753', '224727', '1242078', '1242087', '2564310', '2511819', '913070', '1242094', '28146', '1243579', '149390', '2564349', '913076', '1242101', '1243599', '1243600', '70803', '1124956', '486993', '149387', '596', '28142', '117541', '1151172', '1208611', '1962641', '1243577', '1243578', '1242083', '1242105', '340189', '1129117', '134047', '1194154', '2579247', '367181', '48409', '46626', '598', '938143', '260678', '399583', '1240694', '29472', '1124961', '1967643', '2564534', '1160736', '436295', '1124962', '55400', '1242089', '165302', '149386', '941190', '915158', '1242108', '399587', '2077273', '1160741', '1242090', '59202', '2577863', '1243601', '1243602', '2500152', '1710356', '2577858', '59203', '41515', '1386967', '1243607', '41514', '59204', '1173779', '2339227', '1192842', '1243615', '1243616', '59208', '41520', '59205', '523831', '1299291', '2729104', '1967611']:
            soj.append(key)
        elif value[1] in ['590', '54736', '1299282', '2577118', '1173775', '41527', '1382510', '218493', '1197719', '2614656', '3030529', '2874627', '3030530', '2500542', '2745894', '2991700', '2979871', '2878546', '2816953', '2833771', '2745892', '2500543', '2876620', '2833772', '2879113', '2745891', '2745893']:
            rod.append(key)
        elif value[1] in ['1224', '1236', '91347', '543']:
            taksonomija_iznad.append(key)
        #elif value == ['Salmonella enterica subsp. diarizonae serovar 61:k:1,5', '']:
            #soj.append(key)
    elif d_fastq[key][0] == 'Staphylococcus aureus':
        if value[1] in ['869816', '273036', '1074919', '1323661', '948563', '1305598', '1381115', '282458', '359786', '548473', '1343064', '985006', '93061', '561307', '523796', '1155084', '663951', '1368166', '1392476', '889933', '367830', '451516', '1406863', '1196216', '1193576', '585143', '1229492', '196620', '93062', '1074252', '867914', '685039', '158878', '418127', '546342', '548470', '1201010', '703339', '1118959', '1458279', '1006543', '1194085', '282459', '426430', '1028799', '158879', '1123523', '681288']:
            soj.append(key)
        elif value[1] in ['1279', '985002', '246432', '91994', '3020908', '2929481', '2583989', '2799681', '2836366', '2836367', '2989766', '2989772', '1912064', '2836365', '2807625', '2799680', '1715860', '2813777', '2025492', '2989770', '2807624', '2989768', '2989769', '2836364', '2836369', '2989767', '1654388', '308354', '1282', '1290', '145391', '45972', '1276282', '28035', '1034809', '1283', '279808', '33028', '29388', '72758', '2815305', '283734', '937773', '53344', '29380', '1292', '29378', '29385', '1288', '1286', '1293', '29382', '61015', '46127', '29379', '170573', '985762', '214473', '29384', '1284', '70255', '46126', '2282419', '1295', '155085', '1281', '1294', '70258', '2912228', '2892440', '74706', '2781774', '1955013', '94138', '2044912']:
            rod.append(key)
        elif value[1] in ['1239', '91061', '1385', '90964']:
            taksonomija_iznad.append(key)

print("TOČNO KLASIFICIRANE VRSTE (TRUE POSITIVE): ", len(tocno))
print("TOČNI SOJEVI VRSTA: ", len(soj))
print("TRUE POSITIVE -> TOČNI SOJEVI I VRSTE: ", len(tocno)+len(soj))
print("TOČAN ROD VRSTE: ", len(rod))
print("TOČNA TAKSONOMIJA KOLJENA, RAZREDA, REDA I PORODICE: ", len(taksonomija_iznad))
for t in tocno:
    del d_kraken[t]
for s in soj:
    del d_kraken[s]
for r in rod:
    del d_kraken[r]
for i in taksonomija_iznad:
    del d_kraken[i]
print(len(krivo))
for k in krivo:
    del d_kraken[k]
print(len(d_kraken))
izlazna_datoteka = "pregledaj_datoteku.txt"
f = open(izlazna_datoteka, "w")
for key, value in d_kraken.items():
    krivo.append(key)
    f.write("%s\n" % str(value))
    f.write("%s\n\n" % str(d_fastq[key]))
f.close()
print("FALSE POSITIVE (POGREŠNI): ", len(krivo))
