from Bio import SeqIO

file = open("kraken.out", "r")
d_kraken = {}
unclassified = []
for line in file:
    if line.startswith("C"):
        id = line.split("\t")[1]
        oznaka_krakena = line.split("\t")[2].split("(")[0][:-1]
        taxid = line.split("\t")[2].split("(")[1].split(" ")[1][:-1]
        d_kraken[id] = [oznaka_krakena, taxid]
    elif line.startswith("U"):
        neklasificiran = line.split("\t")[1]
        if neklasificiran not in unclassified:
            unclassified.append(neklasificiran)
file.close()
#print(d_kraken)
#print(unclassified)
print("KLASIFICIRANI: ", len(d_kraken))
print("NEKLASIFICIRANI (FALSE NEGATIVE): ", len(unclassified))

d_fastq = {}
with open("rez95.fastq", "r") as f:
    for record in SeqIO.parse(f, "fastq"):
        id_reada = record.id
        opis = record.description.split(" ")[1].split(",")[0]
        if opis == 'BS.pilon.polished.v3.ST170922':
            d_fastq[id_reada] = [opis, "1423"]
        elif opis == 'Enterococcus_faecalis_complete_genome':
            d_fastq[id_reada] = [opis, "1351"]
        elif opis == 'Escherichia_coli_chromosome':
            d_fastq[id_reada] = [opis, "562"]
        elif opis == 'Lactobacillus_fermentum_complete_genome':
            d_fastq[id_reada] = [opis, "1613"]
        elif opis == 'Listeria_monocytogenes_complete_genome':
            d_fastq[id_reada] = [opis, "1639"]
        elif opis == 'Pseudomonas_aeruginosa_complete_genome':
            d_fastq[id_reada] = [opis, "287"]
        elif opis == 'Salmonella_enterica_chromosome':
            d_fastq[id_reada] = [opis, "28901"]
        elif opis == 'Staphylococcus_aureus_chromosome':
            d_fastq[id_reada] = [opis, "1280"]
        else:
            d_fastq[id_reada] = [opis, "?"]
f.close()
#print(d_fastq)
#print(len(d_fastq))

tocno = []
soj = []
rod = []
krivo = []
taksonomija_iznad = []
for key, value in d_kraken.items():
    if d_fastq[key][1] == value[1]:
        tocno.append(key)
    if value == ['Bacteria', '2'] or d_fastq[key] == ['junk_seq', '?'] or d_fastq[key] == ['random_seq', '?']:
        krivo.append(key)
    elif d_fastq[key][0] == 'BS.pilon.polished.v3.ST170922':
        if value[1] in ["135461","1404258","535024","1192196","535026","1302650","1496303","936156"]:
            soj.append(key)
        elif value[1] in ['1386', '653685', '96241', '1052585', '703612', '655816', '483913', '72361', '653388', '260554', '72360', '1452', '1239783', '1938374', '492670', '1458206', '1150476', '1338518', '1385727', '1449088', '1390', '1333538', '659243', '2054641', '1648923', '1402', '1126218', '227866']:
            rod.append(key)
        elif value[1] in ['185979', '2809036', '2762329', '2049935', '352858', '2014076', '1071078', '1127744', '2070759', '2884834', '2589818', '2683680', '86661', '1405', '1396', '405535', '288681', '526986', '526992', '1428', '1257079', '29339', '570416', '180854', '527030', '1392', '1792192', '293387', '1408', '1664069', '2715209', '2487276']:
            rod.append(key)
        elif value[1] in ['1239', '91061', '1385', '186817']:
            taksonomija_iznad.append(key)
    elif d_fastq[key][0] == 'Enterococcus_faecalis_complete_genome':
        if value[1] in ["565651","1206105","474186","936153","226185","699186","1201292","1287066","1157365","1261557"]:
            soj.append(key)
        elif value[1] in ['1350', '1352', '37734', '44008', '1354', '53345', '417368', '118060']:
            rod.append(key)
        elif value[1] in ['1239', '91061', '186826', '81852']:
            taksonomija_iznad.append(key)
    elif d_fastq[key][0] == 'Escherichia_coli_chromosome':
        if value[1] in ['83334', '155864', '996639', '1328859', '444450', '502346', '386585', '544404', '1343836', '83333', '511145', '879462', '679895', '1245474', '595496', '1403831', '316385', '316407', '168807', '574521', '2861805', '340186', '244320', '701177', '1446746', '2603836', '1055538', '1038927', '1048254', '1134782', '1133853', '1133852', '2848144', '2778655', '2605620', '331112', '2605619', '1392854', '481805', '1329907', '2048777', '2778657', '941322', '1050617', '2848145', '2763104', '591946', '696406', '1045010', '1446701', '1446738', '1446739', '913091', '930406', '1446608', '1001989', '2861806', '991915', '1382700', '585397', '913088', '585057', '2874051', '376725', '869729', '1072458', '1072459', '1446707', '2697517', '2027293', '2067421', '1055537', '1055543', '566546', '2491679', '1412834', '1603259', '331111', '745156', '2233553', '1055541', '2848143', '2048778', '511693', '1311757', '2048781', '469008', '2778656', '405955', '2773707', '1355101', '362663', '316435', '2990471', '2773705', '2810407', '1274814', '2592065', '861906', '216592', '569579', '2048775', '439855', '1401688', '2810404', '2810406', '1358422', '758831', '866768', '585034', '2822132', '1078021', '1055536', '1055540', '364106', '244319', '573235', '37762', '1078034', '585055', '1078032', '1322345', '183192', '3041057', '2048780', '577675', '2778652', '199310', '404399', '1055534', '1055533', '1055535', '1055542', '498388', '168927', '585396', '2491692', '3038394', '2126982', '1392858', '714962', '1502658', '941323', '2874052', '2778654', '536056', '1435461', '2990470', '585035', '2810405', '2491878', '2079157', '2048776', '741093', '1200752', '2810409', '991919', '2027295', '941280', '413997', '1954351', '2773706', '685037', '685038', '1335302', '1335303', '1446600', '595495', '1335916', '373045', '2874053', '2773704', '2814546', '2990469', '1441627', '2072463', '655817', '866789', '1055539', '1055545']:
            soj.append(key)
        elif value[1] in ['561', '208962', '564', '981367', '1499973', '2608889', '2044467']:
            rod.append(key)
        elif value[1] in ['1224', '1236', '91347', '543']:
            taksonomija_iznad.append(key)
        elif value == ['Escherichia coli BL2', ''] or value == ["Escherichia coli 'BL21-Gol", 'AG']:
            soj.append(key)
    elif d_fastq[key][0] == 'Lactobacillus_fermentum_complete_genome':
        if value[1] in ["767453","334390","1381124"]:
            soj.append(key)
        elif value[1] in ['2742598', '1598', '97478', '104955', '47493', '227942']:
            rod.append(key)
        elif value[1] in ['1239', '91061', '186826', '33958']:
            taksonomija_iznad.append(key)
        elif value == ['Lactobacillus sp. 3', '']:
            krivo.append(key)
    elif d_fastq[key][0] == 'Listeria_monocytogenes_complete_genome':
        if value[1] in ['393119', '552536', '2065118', '1196174', '1230340', '1134669', '1196161', '265669', '568819', '1196159', '1196162', '1196172', '1196171', '1196175', '930781', '1906951', '1196165', '1385997', '1386001', '1196170', '1386004', '1196167', '1196168', '1196176', '1386002', '1386005', '1385999', '1386007', '1385998', '1386008', '1196186', '1196180', '1386003', '1386000', '1196188', '1385996', '1196192', '1196181', '1196177', '1196169', '863767', '882097', '879089', '1126011', '882094', '879088', '1457188', '882095', '930782', '393118', '1288295', '169963', '393126', '932919', '393132', '1027396', '932920', '2049008', '1196194', '1196193', '879090', '563174', '393133', '1299895', '1457187', '393127', '1334565', '882096', '1030009', '637381', '2559246', '1386006', '393130', '1437838', '2291966', '1196163', '2291968', '1196195', '882020']:
            soj.append(key)
        elif value[1] in ['1637', '1642', '702455', '529731', '1643', '386043', '1638', '202751', '202752', '1640', '683837', '702453', '2642072', '1844999', '2678528', '1006155', '1641', '1497681']:
            rod.append(key)
        elif value[1] in ['1239', '91061', '1385', '186820']:
            taksonomija_iznad.append(key)
    elif d_fastq[key][0] == 'Pseudomonas_aeruginosa_complete_genome':
        if value[1] in ['381754', '1193501', '1352355', '1427342', '1158200', '1280938', '1009714', '1400868', '208963', '1123015', '1408274', '1279007', '1279008', '388272', '1448140', '1457392', '1408271', '1408272', '1051004', '1093787', '1051003', '1415629', '1340851', '941193', '557722', '1089456', '1356855', '1408276', '208964', '1147787', '1443105', '1408277', '910265', '1408275', '1163396', '1408273', '798130']:
            soj.append(key)
        elif value[1] in ['286', '136841', '627141', '95301', '300', '43263', '53408', '1232139', '301', '1182590', '1149133', '2994495', '196821', '75692', '2545800', '2083055', '2866282', '2804761', '2705472', '2961893', '3034675', '2749999', '2201356', '2748080', '1930532', '1898684', '2871493', '2933816', '2998079', '2653853', '1573718', '2974552', '2866278', '2169583', '2895475', '2664899', '2662033', '1649877', '2870860', '2895495', '1881017', '2879114', '2479393', '2054919', '2219057', '2083051', '2730851', '2762896', '3019098', '3019968', '2816906', '3020843', '2994661', '136843', '294', '463794', '1221522', '746360', '1038922', '380021', '200450', '76760', '47879', '47883', '200452', '76758', '136845', '303', '47880', '78327', '70775', '136849', '251695', '317', '264449', '103796', '33069', '251701', '59511', '136842', '587753', '296', '2725477', '319939', '191390', '312306', '384676', '2565368', '1245526', '2320867', '395598', '237610', '289370', '1274359', '321846', '2731681', '1499686', '485870', '2774461', '2774460', '1392877', '930166', '658629', '640205', '237609', '2493633', '2056231', '2604832', '104087', '157782', '2842355', '2842354', '198618', '216142']:
            rod.append(key)
        elif value[1] in ['1224', '1236', '72274', '135621']:
            taksonomija_iznad.append(key)
        elif value == ['Pseudomonas sp. SL', ''] or value == ['Pseudomonas sp. PS', ''] or value == ['Pseudomonas sp. SC', '']:
            rod.append(key)
    elif d_fastq[key][0] == 'Salmonella_enterica_chromosome':
        if value[1] in ['59201', '90371', '1029978', '1008297', '1620419', '1454642', '1454647', '99287', '588858', '1454638', '568709', '990282', '1454630', '1454639', '1454644', '1454636', '1454641', '1454645', '119912', '904139', '938142', '321314', '149539', '1412457', '1244111', '926034', '1243619', '1412558', '1412550', '1244121', '1412453', '1412562', '1412467', '1243621', '1412580', '1244112', '1244122', '1412470', '1244113', '1412521', '1412456', '1412495', '1412508', '1412464', '1412534', '1412468', '1412603', '1412510', '1412525', '1412476', '1412598', '1412486', '1412532', '1412575', '1412501', '1412616', '1244118', '1244119', '1412548', '1412454', '1412455', '1412536', '1412571', '90370', '1132507', '209261', '220341', '527001', '108619', '796731', '1454627', '930779', '1454620', '796730', '1454621', '997339', '796733', '796732', '858305', '1454622', '423368', '1454618', '1299166', '1454625', '1454617', '1454614', '930778', '858307', '1242080', '1242091', '595', '596155', '28144', '98360', '687860', '909945', '28150', '192955', '1242102', '1242085', '1242107', '58096', '1182174', '1182181', '1208629', '1182188', '1182178', '1182191', '1182183', '1182176', '1208622', '1182180', '1173456', '58712', '1399029', '1454586', '1454596', '984211', '1454585', '1454584', '1454588', '1454590', '54388', '941189', '554290', '295319', '58101', '487004', '1242081', '1242096', '115981', '1454607', '1454603', '1454610', '859199', '1454601', '763921', '1454613', '745022', '1454599', '1454612', '286783', '611', '1160717', '1124936', '454169', '1029997', '211968', '1173798', '189201', '594', '685040', '550538', '593905', '57743', '58095', '454166', '1072590', '1406860', '192954', '984237', '2024273', '82689', '1124958', '1124959', '149391', '930771', '143221', '1003191', '913085', '1243595', '2583588', '90105', '702982', '570935', '941188', '440524', '866913', '28147', '57045', '224729', '1016998', '1160769', '1243590', '1243591', '149385', '149388', '216804', '1242082', '1242098', '29474', '340190', '486994', '1242097', '1242079', '1242088', '57741', '2926665', '192953', '57046', '476213', '2021403', '260368', '1240708', '604', '1225522', '1077085', '286782', '1194159', '29482', '1029983', '932733', '1243585', '340188', '1410916', '1243583', '1243584', '1242084', '1242106', '2564349', '913074', '941187', '600', '1064551', '1151001', '2511819', '913070', '1242094', '363569', '1267753', '224727', '605', '1029979', '1242083', '1242105', '1242078', '1242087', '358771', '913076', '1242101', '1243599', '1243600', '149387', '28142', '181798', '938141', '2564310', '48409', '149390', '58097', '1320309', '70803', '1124956', '134047', '1194154', '28146', '1243579', '486993', '1129117', '1962641', '1243577', '1243578', '596', '2564534', '340189', '29472', '1124961', '117541', '436295', '1124962', '598', '938143', '399583', '1240694', '367181', '1151172', '1208611', '165302', '260678', '1160741', '1242090', '2579247', '1160736', '2077273', '1967643', '46626', '55400', '59202', '2577863', '1243601', '1243602', '2500152', '1710356', '2577858', '59204', '1173779', '2339227', '1192842', '1243615', '1243616', '59203', '41515', '1386967', '1243607', '41514', '59208', '41520', '59205', '523831', '1299291', '2729104']:
            soj.append(key)
        elif value[1] in ['590', '54736', '1299282', '41527', '1382510', '2577118', '2614656', '2879113']:
            rod.append(key)
        elif value[1] in ['1224', '1236', '91347', '543']:
            taksonomija_iznad.append(key)
        elif value == ['Salmonella enterica subsp. diarizonae serovar 61:k:1,5', '']:
            soj.append(key)
    elif d_fastq[key][0] == 'Staphylococcus_aureus_chromosome':
        if value[1] in ['869816', '1074919', '273036', '1381115', '1323661', '282458', '948563', '1305598', '985006', '93061', '561307', '1392476', '359786', '523796', '1155084', '548473', '1196216', '1193576', '889933', '1343064', '1368166', '1229492', '367830', '451516', '663951', '93062', '1074252', '685039', '196620', '1406863', '585143', '546342', '867914', '418127', '1201010', '158878', '548470', '703339', '1194085', '1118959', '282459', '1006543', '1028799', '1458279', '1123523', '426430', '158879', '681288']:
            soj.append(key)
        elif value[1] in ['1279', '985002', '1282', '91994', '3020908', '2799681', '2929481', '2836366', '2836367', '2989772', '1715860', '2583989', '1654388', '308354', '1290', '2815305', '283734', '53344', '29388', '46127', '45972', '1288', '29382', '1286', '28035', '29384', '29385', '170573', '1293', '1292', '985762', '2282419', '33028', '29380', '29378', '46126', '61015', '70255', '29379', '1284', '1283', '1294', '214473', '1281', '246432', '155085', '1295']:
            rod.append(key)
        elif value[1] in ['1239', '91061', '1385', '90964']:
            taksonomija_iznad.append(key)
print("TOČNO KLASIFICIRANE VRSTE: ", len(tocno))
print("TOČNI SOJEVI VRSTA: ", len(soj))
print("TRUE POSITIVE -> TOČNI SOJEVI I VRSTE: ", len(tocno)+len(soj))
print("TOČAN ROD VRSTE: ", len(rod))
print("TOČNA TAKSONOMIJA KOLJENA, RAZREDA, REDA I PORODICE: ", len(taksonomija_iznad))
for t in tocno:
    del d_kraken[t]
for s in soj:
    del d_kraken[s]
for r in rod:
    del d_kraken[r]
for i in taksonomija_iznad:
    del d_kraken[i]
for k in krivo:
    del d_kraken[k]

for key, value in d_kraken.items():
    krivo.append(key)
print("FALSE POSITIVE (POGREŠNI): ", len(krivo))

